const a0O=a0b;(function(a,b){const N=a0b,c=a();while(!![]){try{const d=-parseInt(N(0x22b))/0x1*(parseInt(N(0x21d))/0x2)+parseInt(N(0x1cb))/0x3*(parseInt(N(0x1b1))/0x4)+-parseInt(N(0x1b4))/0x5*(-parseInt(N(0x1ca))/0x6)+parseInt(N(0x1c3))/0x7*(parseInt(N(0x215))/0x8)+parseInt(N(0x1ef))/0x9*(-parseInt(N(0x1c9))/0xa)+parseInt(N(0x1f6))/0xb+parseInt(N(0x210))/0xc*(-parseInt(N(0x1f2))/0xd);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0xe1774));import{connect}from'cloudflare:sockets';let a0c='vl',a0d=a0O(0x1ab),a0e='://',a0f=a0O(0x1de),a0g='25dce6e6-1c37-4e8c-806b-5ef8affd9f55',a0h=![],a0i='',a0j=![],a0k=a0O(0x1cc),a0l=[a0O(0x1fb)],a0m=[''],a0n='SOCKS5版',a0o=!![],a0p=!![],a0q='',a0r='',a0s=[],a0t=0x0;const a0u=0x5*0x3c*0x3e8,a0v=0x1388;let a0w=[a0O(0x1d9),a0O(0x1a5),a0O(0x209),'https://dns.quad9.net/dns-query'],a0x=a0O(0x21e);async function a0y(){const P=a0O;try{const a=await fetch(a0x,{'cf':{'cacheEverything':!![]}});return new Response(a[P(0x229)],a);}catch{return new Response(P(0x1c0),{'status':0xc8,'headers':{'Content-Type':P(0x1d0)}});}}const a0z=(a,b,c)=>{const Q=a0O,d=import.meta?.[Q(0x1bf)]?.[a]??c?.[a];if(d===undefined||d===null||d==='')return b;if(typeof d==='string'){const e=d['trim']();if(e===Q(0x22a))return!![];if(e==='false')return![];if(e['includes']('\x0a'))return e[Q(0x1f0)]('\x0a')[Q(0x207)](f=>f[Q(0x217)]())['filter'](Boolean);if(!isNaN(e)&&e!=='')return Number(e);return e;}return d;};async function a0A(){const R=a0O;if(!a0r){console[R(0x21a)](R(0x225));return;}const a=Date[R(0x201)]();if(a-a0t<a0u&&a0s[R(0x1f9)]>0x0)return;console[R(0x21a)](R(0x1b7));try{const b=await fetch(a0r);if(!b['ok'])throw new Error(R(0x220)+b[R(0x219)]+'\x20(Status:\x20'+b[R(0x20e)]+')');const c=await b['text'](),d=c[R(0x1f0)]('\x0a')['map'](f=>f[R(0x217)]())[R(0x1b9)](f=>f&&!f[R(0x202)]('#'));d[R(0x1f9)]>0x0?(a0s=d,a0t=a,console[R(0x21a)](R(0x1a9)+a0s[R(0x1f9)]+'\x20个\x20SOCKS5\x20地址。')):console['warn']('SOCKS5\x20地址列表文件为空或不含有效地址。将保留上次成功的列表（如果存在）。');}catch(f){console[R(0x200)](R(0x1a7)+f['message']+'。将使用备用\x20SOCKS5_ADDRESS\x20(如果已配置)\x20或上次成功加载的列表。');}}function a0a(){const a9=[',\x20SOCKS5响应码:\x20','headers','无效的UUID','slice','未配置任何\x20SOCKS5\x20代理地址\x20(SOCKS5_TXT_URL\x20或\x20SOCKS5_ADDRESS)。','&path=%2F%3Fed%3D2560#','https://cloudflare-dns.com/dns-query','SOCKS5\x20认证方式不支持:\x20','加载\x20SOCKS5\x20地址列表失败:\x20','readable','成功加载\x20','find','ess','race','写入初始数据到\x20TCP\x20失败:','value','\x20(代理\x20','SOCKS5\x20代理连接失败或超时\x20(','428myBnzR','\x20-\x20','关闭失败连接时出错:','738195ESHJvP','从\x20TCP\x20发送数据到\x20WebSocket\x20失败:','message','正在加载\x20SOCKS5\x20地址列表...','replace','filter','Answer','我的节点名字','无效的SOCKS5目标地址类型',':443#备用节点','lastIndexOf','env','<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20<head><title>Welcome</title></head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20<body><h1>Cloudflare\x20Worker\x20已部署成功</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>此页面为静态伪装页面（远程加载失败）。</p></body>\x0a\x20\x20\x20\x20\x20\x20\x20</html>','security=none','close','428393HTReKX','indexOf','无认证','代理失败:\x20','writable','SOCKS5_GLOBAL','1240XSKKxu','6WsHthW','28926yQShNL','哎呀你找到了我，但是我就是不给你看，气不气，嘿嘿嘿','catch','buffer','sec-websocket-protocol','text/html;\x20charset=utf-8','SOCKS5目标地址连接失败，目标:\x20','\x0a1、本worker的私钥功能只支持通用订阅，其他请关闭私钥功能\x0a2、其他需求自行研究\x0a通用的：https','SOCKS5_ADDRESS','byteLength','Hello\x20World!','notls','SOCKS5_TXT_URL','pathname','https://dns.google/dns-query','get','from','read','toLowerCase','123456','&sni=','send','Bad\x20Gateway:\x20','从\x20WebSocket\x20写入\x20TCP\x20失败:','):\x20','join','VL\x20协议解析或\x20TCP\x20连接失败:','json','any','websocket','data','decode','releaseLock','SOCKS5\x20认证协商响应无效。','getWriter','所有\x20SOCKS5\x20代理尝试均失败:','2844OSdDTy','split','嘲讽语','91osXdnM','Upgrade','从\x20TCP\x20读取数据失败:','无效的\x20IPv6\x20地址格式','16707537nHOIPF','getUint16','push','length','无响应','cloudflare-ddns.zone.id:443#美国\x20域名\x20默认值\x20—\x20Cloudflare\x20CDN\x20节点','AAAA','\x20记录','私钥验证失败','正在并发尝试连接\x20SOCKS5\x20代理:\x20','error','now','startsWith','encode','&type=ws&host=','私钥开关','成功连接\x20SOCKS5\x20代理:\x20','map','url','https://1.1.1.1/dns-query','toString','includes','TXT','Host','status','cancel','2042016XxkUQN','errors','text/plain;charset=utf-8','security=tls','my-key','64Vwdyzy','DOH\x20查询\x20','trim','text','statusText','log','无效的访问地址类型','opened','9754OoABrh','https://cf-worker-dir-bke.pages.dev/','?encryption=none&','无法加载\x20SOCKS5\x20地址列表:\x20','warn','带认证','reject','\x20请求失败:\x20','SOCKS5_TXT_URL\x20未配置，不加载\x20SOCKS5\x20地址列表。','传输管道已关闭。','write','直接连接目标\x20','body','true','212nKjIBA','charCodeAt','连接超时:\x20','getReader'];a0a=function(){return a9;};return a0a();}export default{async 'fetch'(a,b){const S=a0O;a0f=a0z('ID',a0f,b),a0g=a0z('UUID',a0g,b),a0l=a0z('IP',a0l,b),a0m=a0z(S(0x20c),a0m,b),a0i=a0z('私钥',a0i,b),a0j=a0z('隐藏',a0j,b),a0h=a0z(S(0x205),a0h,b),a0k=a0z(S(0x1f1),a0k,b),a0n=a0z(S(0x1bb),a0n,b),a0o=a0z('SOCKS5_ENABLE',a0o,b),a0p=a0z(S(0x1c8),a0p,b),a0q=a0z(S(0x1d3),a0q,b),a0r=a0z(S(0x1d7),a0r,b),await a0A();const c=a[S(0x1a0)][S(0x1da)](S(0x1f3)),d=new URL(a[S(0x208)]);if(!c||c!==S(0x1e8)){if(a0m){const f=Array['isArray'](a0m)?a0m:[a0m],g=[];for(const h of f){try{const i=await fetch(h),j=await i[S(0x218)](),l=j[S(0x1f0)]('\x0a')[S(0x207)](m=>m[S(0x217)]())[S(0x1b9)](m=>m);g['push'](...l);}catch(m){console[S(0x221)]('无法获取或解析优选链接:\x20'+h,m);}}if(g[S(0x1f9)]>0x0)a0l=g;}switch(d[S(0x1d8)]){case'/':return a0y();case'/'+a0f:{const n=a0L(a0f,a[S(0x1a0)][S(0x1da)](S(0x20d)));return new Response(n,{'status':0xc8,'headers':{'Content-Type':S(0x212)}});}case'/'+a0f+'/'+a0c+a0d:{if(a0j)return new Response(a0k,{'status':0xc8,'headers':{'Content-Type':'text/plain;charset=utf-8'}});else{const o=a0M(a[S(0x1a0)]['get'](S(0x20d)));return new Response(o,{'status':0xc8,'headers':{'Content-Type':S(0x212)}});}}default:return new Response(S(0x1d5),{'status':0xc8});}}else{if(a0h){const r=a[S(0x1a0)][S(0x1da)](S(0x214));if(r!==a0i)return new Response(S(0x1fe),{'status':0x193});}const p=a[S(0x1a0)][S(0x1da)](S(0x1cf)),q=a0C(p);if(!a0h&&a0H(new Uint8Array(q[S(0x1a2)](0x1,0x11)))!==a0g)return new Response(S(0x1a1),{'status':0x193});try{const {tcpSocket:s,initialData:t}=await a0D(q);return await a0B(a,s,t);}catch(u){return console[S(0x200)](S(0x1e5),u),new Response(S(0x1e1)+u[S(0x1b6)],{'status':0x1f6});}}}};async function a0B(a,b,c){const {0x0:d,0x1:e}=new WebSocketPair();return e['accept'](),a0G(e,b,c),new Response(null,{'status':0x65,'webSocket':d});}function a0C(a){const T=a0O;return a=a[T(0x1b8)](/-/g,'+')['replace'](/_/g,'/'),Uint8Array[T(0x1db)](atob(a),b=>b[T(0x19c)](0x0))[T(0x1ce)];}async function a0D(a){const U=a0O,d=new DataView(a),f=new Uint8Array(a),g=f[0x11],h=0x12+g+0x1,j=d[U(0x1f7)](h);if(j===0x35)throw new Error('拒绝DNS连接');const k=h+0x2;let l=f[k],m=k+0x1,n,o;switch(l){case 0x1:o=0x4,n=Array[U(0x1db)](f[U(0x1a2)](m,m+o))[U(0x1e4)]('.');break;case 0x2:o=f[m],m+=0x1;const r=new TextDecoder()[U(0x1ea)](f[U(0x1a2)](m,m+o));n=await a0K(r);n!==r&&(l=n[U(0x20b)](':')?0x3:0x1);break;case 0x3:o=0x10;const s=[],t=new DataView(a,m,0x10);for(let u=0x0;u<0x8;u++)s['push'](t[U(0x1f7)](u*0x2)[U(0x20a)](0x10));n=s[U(0x1e4)](':');break;default:throw new Error(U(0x21b));}const p=a[U(0x1a2)](m+o);let q;if(a0o){if(a0p)q=await a0E(l,n,j);else try{q=connect({'hostname':n,'port':j}),await q[U(0x21c)];}catch(v){console[U(0x221)](U(0x228)+n+':'+j+'\x20失败，尝试通过SOCKS5代理:\x20'+v['message']),q=await a0E(l,n,j);}}else q=connect({'hostname':n,'port':j});return await q[U(0x21c)],{'tcpSocket':q,'initialData':p};}async function a0E(a,b,c){const V=a0O;let d=[];a0s[V(0x1f9)]>0x0&&(d=[...a0s]);d[V(0x1f9)]===0x0&&a0q&&d[V(0x1f8)](a0q);if(d[V(0x1f9)]===0x0)throw new Error(V(0x1a3));const e=d[V(0x207)](async(f,g)=>{const W=V;let h=null;try{const {账号:i,密码:j,地址:k,端口:l}=await a0I(f);console['log'](W(0x1ff)+(i?W(0x222):W(0x1c5))+'\x20'+k+':'+l+W(0x1af)+(g+0x1)+'/'+d[W(0x1f9)]+')');const m=new Promise((n,o)=>{const p=setTimeout(()=>{const X=a0b;o(new Error(X(0x19d)+k+':'+l));},a0v);});return h=await Promise[W(0x1ac)]([a0F(i,j,k,l,a,b,c),m]),console[W(0x21a)](W(0x206)+k+':'+l),{'socket':h,'config':f};}catch(n){console[W(0x221)](W(0x1b0)+f+W(0x1e3)+n[W(0x1b6)]);if(h)try{h['close']();}catch(o){console['warn'](W(0x1b3),o);}return Promise[W(0x223)](new Error(W(0x1c6)+f+W(0x1b2)+n[W(0x1b6)]));}});try{const {socket:f,config:g}=await Promise[V(0x1e7)](e);return f;}catch(h){console[V(0x200)](V(0x1ee),h[V(0x211)]['map'](i=>i[V(0x1b6)])[V(0x1e4)](';\x20'));throw new Error('所有\x20SOCKS5\x20代理尝试均失败。');}}async function a0F(a,b,c,d,f,g,h){const Y=a0O,k=connect({'hostname':c,'port':d});let l,m;try{await k[Y(0x21c)],l=k[Y(0x1c7)][Y(0x1ed)](),m=k[Y(0x1a8)]['getReader']();const n=new TextEncoder(),o=new Uint8Array([0x5,0x2,0x0,0x2]);await l[Y(0x227)](o);const p=(await m[Y(0x1dc)]())[Y(0x1ae)];if(!p||p['length']<0x2)throw new Error(Y(0x1ec));if(p[0x1]===0x2){if(!a||!b)throw new Error('SOCKS5\x20代理需要认证，但未配置账号密码。');const t=new Uint8Array([0x1,a[Y(0x1f9)],...n[Y(0x203)](a),b['length'],...n[Y(0x203)](b)]);await l[Y(0x227)](t);const u=(await m[Y(0x1dc)]())[Y(0x1ae)];if(!u||u['length']<0x2||u[0x0]!==0x1||u[0x1]!==0x0)throw new Error('SOCKS5\x20账号密码错误或认证失败。');}else{if(p[0x1]===0x0){}else throw new Error(Y(0x1a6)+p[0x1]);}let q;switch(f){case 0x1:q=new Uint8Array([0x1,...g['split']('.')[Y(0x207)](Number)]);break;case 0x2:q=new Uint8Array([0x3,g[Y(0x1f9)],...n['encode'](g)]);break;case 0x3:const v=g['split'](':'),w=[];let x=![];for(let y=0x0;y<v[Y(0x1f9)];y++){let z=v[y];if(z===''){if(!x){let A=0x8-(v[Y(0x1f9)]-0x1);if(v[0x0]===''&&y===0x0)A++;if(v[v['length']-0x1]===''&&y===v['length']-0x1)A++;for(let B=0x0;B<A;B++){w[Y(0x1f8)](0x0,0x0);}x=!![];}}else{let C=parseInt(z,0x10);w[Y(0x1f8)](C>>0x8&0xff,C&0xff);}}while(w[Y(0x1f9)]<0x10){w[Y(0x1f8)](0x0,0x0);}q=new Uint8Array([0x4,...w]);break;default:throw new Error(Y(0x1bc));}const r=new Uint8Array([0x5,0x1,0x0,...q,h>>0x8,h&0xff]);await l[Y(0x227)](r);const s=(await m[Y(0x1dc)]())[Y(0x1ae)];if(!s||s[Y(0x1f9)]<0x2||s[0x0]!==0x5||s[0x1]!==0x0)throw new Error(Y(0x1d1)+g+':'+h+Y(0x19f)+(s?s[0x1]:Y(0x1fa)));return l[Y(0x1eb)](),m[Y(0x1eb)](),k;}catch(D){if(l)l[Y(0x1eb)]();if(m)m[Y(0x1eb)]();if(k)k[Y(0x1c2)]();throw D;}}async function a0G(a,b,c){const Z=a0O;a['send'](new Uint8Array([0x0,0x0]));const d=b['writable'][Z(0x1ed)](),f=b['readable'][Z(0x19e)]();c&&c[Z(0x1d4)]>0x0&&await d[Z(0x227)](c)[Z(0x1cd)](g=>console[Z(0x200)](Z(0x1ad),g));a['addEventListener'](Z(0x1b6),async g=>{const a0=Z;if(g[a0(0x1e9)]instanceof ArrayBuffer)try{await d[a0(0x227)](g[a0(0x1e9)]);}catch(h){console[a0(0x200)](a0(0x1e2),h);}else console['warn']('收到非\x20ArrayBuffer\x20类型数据\x20(WebSocket):',g[a0(0x1e9)]);});try{while(!![]){const {value:g,done:h}=await f[Z(0x1dc)]();if(h)break;if(g)try{a[Z(0x1e0)](g);}catch(i){console[Z(0x200)](Z(0x1b5),i);break;}}}catch(j){console[Z(0x200)](Z(0x1f4),j);}finally{try{a['close']();}catch(k){console['warn']('关闭\x20WebSocket\x20失败:',k);}try{f[Z(0x20f)]();}catch(l){console[Z(0x221)]('取消\x20TCP\x20读取器失败:',l);}try{d[Z(0x1eb)]();}catch(m){console[Z(0x221)]('释放\x20TCP\x20写入器锁失败:',m);}try{b['close']();}catch(n){console[Z(0x221)]('关闭\x20TCP\x20连接失败:',n);}console[Z(0x21a)](Z(0x226));}}function a0b(a,b){const c=a0a();return a0b=function(d,e){d=d-0x19c;let f=c[d];return f;},a0b(a,b);}function a0H(b){const a1=a0O,c=Array[a1(0x1db)](b,d=>d[a1(0x20a)](0x10)['padStart'](0x2,'0'))[a1(0x1e4)]('');return c[a1(0x1a2)](0x0,0x8)+'-'+c[a1(0x1a2)](0x8,0xc)+'-'+c[a1(0x1a2)](0xc,0x10)+'-'+c[a1(0x1a2)](0x10,0x14)+'-'+c['slice'](0x14);}async function a0I(a){const a2=a0O,b=a[a2(0x1be)]('@');if(b===-0x1){const [j,k]=a0J(a);return{'账号':'','密码':'','地址':j,'端口':k};}const c=a[a2(0x1a2)](0x0,b),d=a[a2(0x1a2)](b+0x1),e=c[a2(0x1be)](':'),f=e>-0x1?c['slice'](0x0,e):'',g=e>-0x1?c[a2(0x1a2)](e+0x1):'',[h,i]=a0J(d);return{'账号':f,'密码':g,'地址':h,'端口':i};}function a0J(a){const a3=a0O;let b,c;if(a[a3(0x202)]('[')){const d=a[a3(0x1c4)](']');if(d===-0x1)throw new Error(a3(0x1f5));b=a[a3(0x1a2)](0x1,d);const e=a[a3(0x1a2)](d+0x1);c=e[a3(0x202)](':')?Number(e['slice'](0x1)):0x1bb;if(isNaN(c)||c<=0x0||c>0xffff)c=0x1bb;}else{const f=a[a3(0x1be)](':');f>-0x1&&!isNaN(Number(a['slice'](f+0x1)))?(b=a[a3(0x1a2)](0x0,f),c=Number(a['slice'](f+0x1))):(b=a,c=0x1bb);}return[b,c];}async function a0K(a){const a4=a0O,b=c=>a0w[a4(0x207)](d=>fetch(d+'?name='+a+'&type='+c,{'headers':{'Accept':'application/dns-json'}})['then'](f=>f[a4(0x1e6)]())['then'](f=>{const a5=a4,g=f[a5(0x1ba)]?.[a5(0x1aa)](h=>h['type']===(c==='A'?0x1:0x1c))?.[a5(0x1e9)];if(g)return g;return Promise[a5(0x223)]('无\x20'+c+a5(0x1fd));})['catch'](f=>Promise[a4(0x223)](d+'\x20'+c+a4(0x224)+f)));try{return await Promise[a4(0x1e7)](b('A'));}catch(c){try{return await Promise['any'](b(a4(0x1fc)));}catch(d){return console[a4(0x221)](a4(0x216)+a+'\x20失败\x20(IPv4\x20和\x20IPv6):\x20'+d[a4(0x1b6)]),a;}}}function a0L(a,b){const a6=a0O;return a6(0x1d2)+a0e+b+'/'+a+'/'+a0c+a0d+'\x0a';}function a0M(a){const a7=a0O,b=a0l[a7(0x1f9)]===0x0||a0l[a7(0x1f9)]===0x1&&a0l[0x0]==='',c=a0m[a7(0x1f9)]===0x0||a0m['length']===0x1&&a0m[0x0]==='',d=!b||!c?a0l:[a+a7(0x1bd)];return a0h?'请先关闭私钥功能':d[a7(0x207)](e=>{const a8=a7,f=e[a8(0x1f0)]('@');let g=f[0x0],h=a8(0x213);if(f[a8(0x1f9)]>0x1){const n=f[0x1];n[a8(0x1dd)]()===a8(0x1d6)&&(h=a8(0x1c1));}const [i,j=a0n]=g[a8(0x1f0)]('#'),k=i[a8(0x1f0)](':'),l=k[a8(0x1f9)]>0x1&&!isNaN(Number(k[k['length']-0x1]))?Number(k['pop']()):0x1bb,m=k[a8(0x1e4)](':');return''+a0c+a0d+a0e+a0g+'@'+m+':'+l+a8(0x21f)+h+a8(0x1df)+a+a8(0x204)+a+a8(0x1a4)+j;})[a7(0x1e4)]('\x0a');}
