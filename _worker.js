const a0O=a0b;(function(a,b){const N=a0b,c=a();while(!![]){try{const d=parseInt(N(0xbf))/0x1*(-parseInt(N(0x100))/0x2)+-parseInt(N(0xf1))/0x3*(parseInt(N(0xad))/0x4)+parseInt(N(0x10a))/0x5+-parseInt(N(0xb9))/0x6+parseInt(N(0x105))/0x7+-parseInt(N(0xc9))/0x8+parseInt(N(0xba))/0x9;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0x46925));import{connect}from'cloudflare:sockets';const a0c='vl',a0d='ess',a0e=a0O(0xeb);let a0f=a0O(0x112),a0g='25dce6e6-1c37-4e8c-806b-5ef8affd9f55',a0h=![],a0i='',a0j=![],a0k=a0O(0xe8),a0l=[a0O(0x104)],a0m=[''],a0n=a0O(0xc6),a0o=!![],a0p=!![],a0q='',a0r='',a0s=[],a0t=0x0;const a0u=0x5*0x3c*0x3e8,a0v=0x1388,a0w=['https://dns.google/dns-query',a0O(0x12b),a0O(0xca),'https://dns.quad9.net/dns-query'],a0x=a0O(0x124);async function a0y(){const P=a0O;try{const a=await fetch(a0x,{'cf':{'cacheEverything':!![]}});return new Response(a[P(0xdb)],a);}catch{return new Response(P(0xe7),{'status':0xc8,'headers':{'Content-Type':P(0x109)}});}}const a0z=(a,b,c)=>{const Q=a0O,d=import.meta?.['env']?.[a]??c?.[a];if(d===undefined||d===null||d==='')return b;if(typeof d===Q(0x11c)){const e=d['trim']();if(e==='true')return!![];if(e===Q(0xcd))return![];if(e['includes']('\x0a'))return e[Q(0xea)]('\x0a')['map'](f=>f[Q(0xe4)]())[Q(0xe3)](Boolean);if(!isNaN(e)&&e!=='')return Number(e);return e;}return d;};async function a0A(){const R=a0O;if(!a0r){console[R(0xf2)](R(0xbc));return;}const a=Date['now']();if(a-a0t<a0u&&a0s[R(0xd7)]>0x0)return;console[R(0xf2)](R(0xc5));try{const b=await fetch(a0r);if(!b['ok'])throw new Error(R(0xec)+b[R(0xe5)]+'\x20(状态:\x20'+b[R(0xb0)]+')');const c=await b['text'](),d=c['split']('\x0a')['map'](f=>f['trim']())[R(0xe3)](f=>f&&!f[R(0x10c)]('#'));d['length']>0x0?(a0s=d,a0t=a,console['log'](R(0x120)+a0s['length']+R(0x107))):console[R(0xf4)](R(0x121));}catch(f){console[R(0xce)](R(0xec)+f[R(0x115)]+'。将使用备用窝点（如已配置）或上次的成功名单。');}}export default{async 'fetch'(a,b){const S=a0O;a0f=a0z('ID',a0f,b),a0g=a0z(S(0xd3),a0g,b),a0l=a0z('IP',a0l,b),a0m=a0z('TXT',a0m,b),a0i=a0z('私钥',a0i,b),a0j=a0z('隐藏',a0j,b),a0h=a0z(S(0xe1),a0h,b),a0k=a0z(S(0xf7),a0k,b),a0n=a0z('我的节点名字',a0n,b),a0o=a0z(S(0x11f),a0o,b),a0p=a0z(S(0xe0),a0p,b),a0q=a0z(S(0x10e),a0q,b),a0r=a0z(S(0x119),a0r,b),await a0A();const c=a['headers'][S(0x111)](S(0xc8)),d=new URL(a[S(0xfc)]);if(!c||c!==S(0x125)){if(a0m){const f=Array[S(0xd8)](a0m)?a0m:[a0m],g=[];for(const h of f){try{const i=await fetch(h),j=await i[S(0xd2)](),l=j[S(0xea)]('\x0a')[S(0xb8)](m=>m['trim']())['filter'](m=>m);g[S(0xb3)](...l);}catch(m){console[S(0xf4)](S(0x117)+h,m);}}if(g[S(0xd7)]>0x0)a0l=g;}switch(d[S(0xd0)]){case'/':return a0y();case'/'+a0f:{const n=a0L(a0f,a['headers'][S(0x111)](S(0x131)));return new Response(n,{'status':0xc8,'headers':{'Content-Type':S(0xd6)}});}case'/'+a0f+'/'+a0c+a0d:{if(a0j)return new Response(a0k,{'status':0xc8,'headers':{'Content-Type':S(0xd6)}});else{const o=a0M(a[S(0xae)]['get'](S(0x131)));return new Response(o,{'status':0xc8,'headers':{'Content-Type':S(0xd6)}});}}default:return new Response(S(0x136),{'status':0xc8});}}else{if(a0h){const r=a[S(0xae)][S(0x111)](S(0x11a));if(r!==a0i)return new Response(S(0xf9),{'status':0x193});}const p=a[S(0xae)]['get']('sec-websocket-protocol'),q=a0C(p);if(!a0h&&a0H(new Uint8Array(q['slice'](0x1,0x11)))!==a0g)return new Response(S(0xe2),{'status':0x193});try{const {tcpSocket:s,初始数据:t}=await a0D(q);return await a0B(a,s,t);}catch(u){return console[S(0xce)](S(0x132),u),new Response('接头失败:\x20'+u['message'],{'status':0x1f6});}}}};async function a0B(a,b,c){const T=a0O,{0x0:d,0x1:e}=new WebSocketPair();return e[T(0xc1)](),a0G(e,b,c),new Response(null,{'status':0x65,'webSocket':d});}function a0C(a){const U=a0O;return a=a[U(0xdc)](/-/g,'+')['replace'](/_/g,'/'),Uint8Array['from'](atob(a),b=>b[U(0x11d)](0x0))[U(0x110)];}async function a0D(a){const V=a0O,b=new DataView(a),c=new Uint8Array(a),d=c[0x11],f=0x12+d+0x1,g=b[V(0xac)](f);if(g===0x35)throw new Error(V(0x133));const h=f+0x2;let j=c[h],k=h+0x1,l,m;switch(j){case 0x1:m=0x4,l=Array['from'](c[V(0x113)](k,k+m))[V(0x130)]('.');break;case 0x2:m=c[k],k+=0x1;const p=new TextDecoder()[V(0x12f)](c['slice'](k,k+m));l=await a0I(p);l!==p&&(j=l['includes'](':')?0x3:0x1);break;case 0x3:m=0x10;const q=[],r=new DataView(a,k,0x10);for(let s=0x0;s<0x8;s++)q[V(0xb3)](r[V(0xac)](s*0x2)[V(0x116)](0x10));l=q[V(0x130)](':');break;default:throw new Error(V(0x118));}const n=a['slice'](k+m);let o;if(a0o){if(a0p)o=await a0E(j,l,g);else try{o=connect({'hostname':l,'port':g}),await o[V(0x123)];}catch(t){console['warn'](V(0x126)+l+':'+g+'\x20失败，尝试探子接头:\x20'+t['message']),o=await a0E(j,l,g);}}else o=connect({'hostname':l,'port':g});return await o[V(0x123)],{'tcpSocket':o,'初始数据':n};}async function a0E(a,b,c){const W=a0O;let d=[];a0s[W(0xd7)]>0x0&&(d=[...a0s]);d['length']===0x0&&a0q&&d[W(0xb3)](a0q);if(d[W(0xd7)]===0x0)throw new Error(W(0xb7));const e=d[W(0xb8)](async(f,g)=>{const X=W;let h=null;try{const {匪号:i,密码:j,窝点:k,端口:l}=a0J(f);console[X(0xf2)]('正在尝试与探子接头:\x20'+(i?'带暗号':X(0xef))+'\x20'+k+':'+l+'\x20(探子\x20'+(g+0x1)+'/'+d['length']+')');const m=new Promise((n,o)=>{const p=setTimeout(()=>{const Y=a0b;o(new Error(Y(0xb6)+k+':'+l));},a0v);});return h=await Promise[X(0x11b)]([a0F(i,j,k,l,a,b,c),m]),console[X(0xf2)]('成功与探子接头:\x20'+k+':'+l),{'socket':h,'config':f};}catch(n){console[X(0xf4)](X(0xfa)+f+'):\x20'+n[X(0x115)]);if(h)try{h[X(0x137)]();}catch(o){console[X(0xf4)]('关闭失败的接头出错:',o);}return Promise['reject'](new Error('探子失败:\x20'+f+'\x20-\x20'+n[X(0x115)]));}});try{const {socket:f}=await Promise[W(0xbb)](e);return f;}catch(g){console[W(0xce)](W(0xde),g[W(0x103)][W(0xb8)](h=>h['message'])[W(0x130)](';\x20'));throw new Error(W(0x101));}}async function a0F(a,b,c,d,f,g,h){const Z=a0O,k=connect({'hostname':c,'port':d});let l,m;try{await k[Z(0x123)],l=k[Z(0xed)]['getWriter'](),m=k[Z(0xff)]['getReader']();const n=new TextEncoder(),o=new Uint8Array([0x5,0x2,0x0,0x2]);await l[Z(0x10d)](o);const p=(await m[Z(0xfe)]())['value'];if(!p||p[Z(0xd7)]<0x2)throw new Error(Z(0x122));if(p[0x1]===0x2){if(!a||!b)throw new Error(Z(0x10f));const t=new Uint8Array([0x1,a[Z(0xd7)],...n[Z(0x128)](a),b[Z(0xd7)],...n[Z(0x128)](b)]);await l[Z(0x10d)](t);const u=(await m[Z(0xfe)]())[Z(0x108)];if(!u||u[Z(0xd7)]<0x2||u[0x0]!==0x1||u[0x1]!==0x0)throw new Error(Z(0xfb));}else{if(p[0x1]===0x0){}else throw new Error(Z(0xbe)+p[0x1]);}let q;switch(f){case 0x1:q=new Uint8Array([0x1,...g[Z(0xea)]('.')[Z(0xb8)](Number)]);break;case 0x2:q=new Uint8Array([0x3,g[Z(0xd7)],...n['encode'](g)]);break;case 0x3:const v=g['split'](':'),w=[];let x=![];for(let y=0x0;y<v[Z(0xd7)];y++){let z=v[y];if(z===''){if(!x){let A=0x8-(v['length']-0x1);if(v[0x0]===''&&y===0x0)A++;if(v[v[Z(0xd7)]-0x1]===''&&y===v['length']-0x1)A++;for(let B=0x0;B<A;B++){w[Z(0xb3)](0x0,0x0);}x=!![];}}else{let C=parseInt(z,0x10);w[Z(0xb3)](C>>0x8&0xff,C&0xff);}}while(w[Z(0xd7)]<0x10){w['push'](0x0,0x0);}q=new Uint8Array([0x4,...w]);break;default:throw new Error(Z(0xe6));}const r=new Uint8Array([0x5,0x1,0x0,...q,h>>0x8,h&0xff]);await l[Z(0x10d)](r);const s=(await m[Z(0xfe)]())[Z(0x108)];if(!s||s[Z(0xd7)]<0x2||s[0x0]!==0x5||s[0x1]!==0x0)throw new Error(Z(0x134)+g+':'+h+',\x20SOCKS5\x20回应码:\x20'+(s?s[0x1]:Z(0xf3)));return l[Z(0xcb)](),m[Z(0xcb)](),k;}catch(D){if(l)l['releaseLock']();if(m)m[Z(0xcb)]();if(k)k[Z(0x137)]();throw D;}}async function a0G(a,b,c){const a0=a0O;a[a0(0xbd)](new Uint8Array([0x0,0x0]));const d=b[a0(0xed)][a0(0xf8)](),f=b[a0(0xff)]['getReader']();c&&c[a0(0xc7)]>0x0&&await d['write'](c)[a0(0xb4)](g=>console[a0(0xce)](a0(0xb1),g));a[a0(0xee)](a0(0x115),async g=>{const a1=a0;if(g[a1(0xfd)]instanceof ArrayBuffer)try{await d[a1(0x10d)](g[a1(0xfd)]);}catch(h){console['error'](a1(0xd9),h);}else console[a1(0xf4)](a1(0x12d),g[a1(0xfd)]);});try{while(!![]){const {value:g,done:h}=await f[a0(0xfe)]();if(h)break;if(g)try{a[a0(0xbd)](g);}catch(i){console['error'](a0(0xd4),i);break;}}}catch(j){console[a0(0xce)](a0(0xaf),j);}finally{try{a[a0(0x137)]();}catch(k){console[a0(0xf4)](a0(0x102),k);}try{f[a0(0xf0)]();}catch(l){console['warn'](a0(0x12c),l);}try{d[a0(0xcb)]();}catch(m){console[a0(0xf4)](a0(0x129),m);}try{b[a0(0x137)]();}catch(n){console[a0(0xf4)](a0(0xc2),n);}console['log'](a0(0xdf));}}function a0a(){const a9=['2464090qlSchL','请先关闭私钥功能','startsWith','write','SOCKS5_ADDRESS','探子窝点需要暗号，但没配置。','buffer','get','123456','slice','?name=','message','toString','从名单联络据点失败:\x20','无效的目标地址类型','SOCKS5_TXT_URL','my-key','race','string','charCodeAt','then','SOCKS5_ENABLE','成功加载\x20','探子名单文件为空或无有效窝点。保留上次成功的名单。','SOCKS5\x20匪帮规矩回应不对。','opened','https://cf-worker-dir-bke.pages.dev/','websocket','直连\x20','padStart','encode','释放接头管子写入锁失败:','pop','https://cloudflare-dns.com/dns-query','取消接头管子读取失败:','收到非二进制数据\x20(寻常路人):','application/dns-json','decode','join','Host','匪帮暗号解析或接头失败:','拒绝DNS联络','SOCKS5\x20目标接头失败。目标:\x20','notls','来者何人!','close','toLowerCase','getUint16','325564qYKOOG','headers','从接头管子读取数据失败:','status','写入初始数据到接头管子失败:','&path=%2F%3Ded%3D2560#','push','catch','lastIndexOf','接头超时:\x20','没有配置探子窝点\x20(探子名单或探子窝点)。','map','477342iDKqLf','12353031RFpxeW','any','探子名单未配置，跳过加载。','send','不支持的\x20SOCKS5\x20匪帮规矩:\x20','26pPdmBE','&type=ws&host=','accept','关闭接头管子失败:','无效的IPv6地址格式','\x20记录','正在加载探子名单...','SOCKS5版','byteLength','Upgrade','3925008uHxYnL','https://1.1.1.1/dns-query','releaseLock','reject','false','error','&sni=','pathname','\x20失败\x20(IPv4和IPv6都失败了):\x20','text','UUID','从接头管子发送数据到寻常路人失败:','?encryption=none&','text/plain;charset=utf-8','length','isArray','从寻常路人写入到接头管子失败:','security=tls','body','replace','indexOf','所有探子接头都失败了:','水管接头已关闭。','SOCKS5_GLOBAL','私钥开关','暗号不对','filter','trim','statusText','无效的\x20SOCKS5\x20目标地址类型','<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20<head><title>欢迎光临</title></head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20<body><h1>云端响马工头已在此安寨</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>此页面为静态伪装页面（联络失败）。</p></body>\x0a\x20\x20\x20\x20\x20\x20\x20</html>','哎呀你找到了我，但是我就是不给你看，气不气，嘿嘿嘿','\x20联络失败:\x20','split','://','加载探子名单失败:\x20','writable','addEventListener','不带暗号','cancel','21yzOXMm','log','无回应','warn','security=none','Answer','嘲讽语','getWriter','信物不对，杀！','探子接头失败或超时\x20(','SOCKS5\x20匪号/密码不对或认证失败。','url','data','read','readable','36118OgMawn','所有探子接头都失败了。','关闭寻常路人失败:','errors','cloudflare-ddns.zone.id:443#北美匪帮大寨','231966TqZSJK','&type=','\x20个探子窝点。','value','text/html;\x20charset=utf-8'];a0a=function(){return a9;};return a0a();}function a0H(a){const a2=a0O,b=Array['from'](a,c=>c[a2(0x116)](0x10)[a2(0x127)](0x2,'0'))[a2(0x130)]('');return b['slice'](0x0,0x8)+'-'+b[a2(0x113)](0x8,0xc)+'-'+b[a2(0x113)](0xc,0x10)+'-'+b[a2(0x113)](0x10,0x14)+'-'+b['slice'](0x14);}async function a0I(a){const a3=a0O,b=c=>a0w['map'](d=>fetch(d+a3(0x114)+a+a3(0x106)+c,{'headers':{'Accept':a3(0x12e)}})[a3(0x11e)](f=>f['json']())[a3(0x11e)](f=>{const a4=a3,g=f[a4(0xf6)]?.['find'](h=>h['type']===(c==='A'?0x1:0x1c))?.[a4(0xfd)];if(g)return g;return Promise[a4(0xcc)]('没有\x20'+c+a4(0xc4));})[a3(0xb4)](f=>Promise[a3(0xcc)](d+'\x20'+c+a3(0xe9)+f)));try{return await Promise[a3(0xbb)](b('A'));}catch(c){try{return await Promise[a3(0xbb)](b('AAAA'));}catch(d){return console['warn']('联络\x20'+a+a3(0xd1)+d[a3(0x115)]),a;}}}function a0J(a){const a5=a0O,b=a[a5(0xb5)]('@');if(b===-0x1){const [j,k]=a0K(a);return{'匪号':'','密码':'','窝点':j,'端口':k};}const c=a[a5(0x113)](0x0,b),d=a[a5(0x113)](b+0x1),e=c[a5(0xb5)](':'),f=e>-0x1?c[a5(0x113)](0x0,e):'',g=e>-0x1?c[a5(0x113)](e+0x1):'',[h,i]=a0K(d);return{'匪号':f,'密码':g,'窝点':h,'端口':i};}function a0b(a,b){const c=a0a();return a0b=function(d,e){d=d-0xac;let f=c[d];return f;},a0b(a,b);}function a0K(a){const a6=a0O;let b,c;if(a[a6(0x10c)]('[')){const d=a[a6(0xdd)](']');if(d===-0x1)throw new Error(a6(0xc3));b=a['slice'](0x1,d);const e=a['slice'](d+0x1);c=e[a6(0x10c)](':')?Number(e[a6(0x113)](0x1)):0x1bb;if(isNaN(c)||c<=0x0||c>0xffff)c=0x1bb;}else{const f=a[a6(0xb5)](':');f>-0x1&&!isNaN(Number(a[a6(0x113)](f+0x1)))?(b=a['slice'](0x0,f),c=Number(a[a6(0x113)](f+0x1))):(b=a,c=0x1bb);}return[b,c];}function a0L(a,b){return'\x0a1、本worker的私钥功能只支持通用订阅，其他请关闭私钥功能\x0a2、其他需求自行研究\x0a通用的：https'+a0e+b+'/'+a+'/'+a0c+a0d+'\x0a';}function a0M(a){const a7=a0O,b=a0l[a7(0xd7)]===0x0||a0l[a7(0xd7)]===0x1&&a0l[0x0]==='',c=a0m[a7(0xd7)]===0x0||a0m[a7(0xd7)]===0x1&&a0m[0x0]==='',d=!b||!c?a0l:[a+':443#备用节点'];return a0h?a7(0x10b):d[a7(0xb8)](e=>{const a8=a7,f=e[a8(0xea)]('@');let g=f[0x0],h=a8(0xda);if(f['length']>0x1){const n=f[0x1];n[a8(0x138)]()===a8(0x135)&&(h=a8(0xf5));}const [i,j=a0n]=g[a8(0xea)]('#'),k=i['split'](':'),l=k[a8(0xd7)]>0x1&&!isNaN(Number(k[k[a8(0xd7)]-0x1]))?Number(k[a8(0x12a)]()):0x1bb,m=k[a8(0x130)](':');return''+a0c+a0d+a0e+a0g+'@'+m+':'+l+a8(0xd5)+h+a8(0xcf)+a+a8(0xc0)+a+a8(0xb2)+j;})['join']('\x0a');}
